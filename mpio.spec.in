# -*- rpm-spec -*-
%define version @VERSION@
%define release 1
%define name    mpio
%define spec_path @SPEC_PATH@
%define	prefix		/usr
%define sysconfdir	%prefix/etc

Version: %version
Summary: MPIO - providing access to MPIO mp3 players
Name: %name
Release: %release
Copyright: see COPYING
Group: Applications/MultiMedia
Source: http://download.sourceforge.net/mpio/mpio-@VERSION@.tar.gz
Prefix: %prefix
Buildroot: /var/tmp/mpio-@VERSION@-buildroot/
Packager: Andreas Büsching <crunchy@tzi.de>

%description
This is a project for using Digitalway/Adtec digital audio player MPIO
(DMG, DMK, DME) under Linux. It provides Linux kernel module driver,
a userspace library and at the moment one tool to access the MPIO player.

%prep
%setup
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%prefix -sysconfdir=%sysconfdir

%build
make

%install
rm -rf $RPM_BUILD_ROOT
KVERSION=`uname -r`

echo "%defattr(755,root,root)" > /tmp/mpio-files.lst
echo "%prefix/bin/mpiosh" >> /tmp/mpio-files.lst
echo "%prefix/bin/mpiologo" >> /tmp/mpio-files.lst
echo "%prefix/lib/libmpio*" >> /tmp/mpio-files.lst
echo "%defattr(700,root,root)" >> /tmp/mpio-files.lst
echo "%prefix/sbin/mkmpiodev" >> /tmp/mpio-files.lst
echo "%defattr(644,root,root)" >> /tmp/mpio-files.lst
echo "/lib/modules/$KVERSION/%{spec_path}/mpio.o" >> /tmp/mpio-files.lst
echo "%defattr(644,root,root)" >> /tmp/mpio-files.lst
echo "%sysconfdir/mpio/mpioshrc" >> /tmp/mpio-files.lst

make DESTDIR=$RPM_BUILD_ROOT install

%post
mkmpiodev
ldconfig
depmod -a

%preun
mkmpiodev -r

%files -f /tmp/mpio-files.lst

%doc COPYING ChangeLog INSTALL NEWS
%doc README TODO

%clean
rm -rf $RPM_BUILD_ROOT
rm -f /tmp/mpio-files.lst

