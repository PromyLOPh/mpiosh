2002-10-13  Markus Germeier  <mager@tzi.de>

	* mpiosh/callback.c (mpiosh_cmd_dump): fixed compile and
	  logic error due to now "missing" mpiosh_cmd_get

2002-10-13  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/callback.c: removed the callback functions of get, put
	and del. This work is done by mget, mput and mdel now.

	* mpiosh/readline.c (mpiosh_readline_comp_mpio_file): fixed a
	crash which ocurrs when there is no connection to the player
	opened. Also stop readline from using default filename completion
	in the case of not returning any results.

2002-10-13  Markus Germeier  <mager@tzi.de>

	* all operations on external memory should work now!
	* libmpio/ecc.c (mpio_ecc_256_check): 
	  1 Bit errors are now automagically corrected
	
2002-10-13  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_init): fixed segv when external memory
	  was selected
	* formatting of external memory is now completly supported 
	  (untested ATM)

2002-10-12  Andreas Buesching  <crunchy@tzi.de>

	* configure.in: changed version to 0.6.0 for the next release;
	add check for a usable path to the kernel header files

	* mpiosh/global.c (commands): removed commands 'put', 'get', 'del'
	and 'exit' and add these to the alias lists of 'mput', 'mget',
	'mdel' and 'quit'. Also add some more aliases to some other
	commands

	* mpiosh/readline.c (mpiosh_readline_comp_cmd): add aliases to
	completion list

	* mpiosh/global.c (commands): use command completion for 'help'
	arguments

	* mpiosh/global.h: add alias list to command struct

	* mpiosh/global.c: new file containing global symbols as the
	command list

	* mpiosh/callback.c: fix compiler warnings

	* libmpio/mpio.c (mpio_memory_format): fixed compiler warning

	* mpiosh/readline.c: new file containing all stuff around the
	readline library
	(mpiosh_readline_comp_mpio_file): doing completion on files of the
	current mpio memory card
	(mpiosh_readline_init): inserted bug fix for the completion
	quoting from Mathieu

2002-10-05  Markus Germeier  <mager@tzi.de>
	* big changes to IO layer and updates to formating/writing
	  for external memory
	* BEWARE: writing to external mem still does not work
	  and I might have damaged the internal support!
	
2002-10-05  Markus Germeier  <mager@tzi.de>

	* libmpio/cis.c: generate new CIS block for formatting

2002-09-30  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_init): fixed identification of
	  newer firmwares (e.g. DMG+)  "MPIOxy" vs. "MPIO-xy"
	  thanks to mathieu for reporting this one.

2002-09-28  Markus Germeier  <mager@tzi.de>

	* kernel/Makefile.am (distclean): added target distclean

2002-09-28  Markus Germeier  <mager@tzi.de>
	* a lot of changes!
	* reading from external memory should work now correctly
	* BEWARE: all write operations are still broken on external mem!

2002-09-24  Markus Germeier  <mager@tzi.de>
	* libmpio/directory.c (mpio_dentry_put): fixed 8.3 handling
	  to allow correct writing of CONFIG.DAT
	  (mpio_dentry_find_name_8_3): fixed handling of given filename
	* libmpio/mpio.c (mpio_file_del, mpio_file_get): 
	  system files (like sysdum?.du?) can now be read and deleted
	  (mpio_file_put): use mpio_filetype_t to tag files which are
	  written to the internal memory (it is now possible to write
	  config files back to the player)

2002-09-24  Markus Germeier  <mager@tzi.de>
	* a lot of little changes and updates
	* mpiosh/callback.c (mpiosh_cmd_dump_mem): 
	  renamed function from debug_memory to dump_memory
	  (mpiosh_callback_init): display progress of internal and
	  external memory
	* libmpio/mpio.c (mpio_check_filename): added function
	  to check for string zero termination (more to check??)
	  (mpio_memory_dump): dump all relevant memory areas
	  (mpio_init): read spare area for external memory
	* libmpio/defs.h: added mpio_callback_t, mpio_callback_init_t
	  and mpio_filename_t

2002-09-22  Andreas Buesching  <crunchy@tzi.de>

	* configure.in (SPEC_PATH): needed for the spec file to find the
	kernel module

2002-09-22  Markus Germeier  <mager@tzi.de>
	* mpiosh/callback.c (mpiosh_cmd_mdel): 
	  fixed logical error in abort handling which corrupted
	  FAT and directory
	  (mpiosh_cmd_mget): call the correct callback function
	  (mpiosh_callback_put): introduced mpiosh_cancel_ack
	  to fix annoying displays in case of an abort
	  (mpiosh_cmd_mput): don't break mput if an FILE_EXITS
	  is encountered

2002-09-21  Andreas Buesching  <crunchy@tzi.de>

	* mpio.spec.in (CFLAGS): add 'depmod -a' call to post install
	instructions

	* kernel/Makefile.am: add target clean and fixed the install
	target to not strip the kernel module

2002-09-21  Yuji Touya  <salmoon@users.sourceforge.net>

	* README: Add a few lines about Hot plug for 2.4.x

2002-09-20  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_init): 
	  added code to identify DMG+ (assumed, but should be correct)

	* mpiosh/callback.c (mpiosh_cmd_format, mpiosh_cmd_mem): 
	  added warning messages for the upcoming release.
	  (mpiosh_cmd_get, mpiosh_cmd_put): added missing printf

2002-09-20  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/mpiosh.c (mpiosh_command_regex_fix): bug fix for .*
        do not quote the '.' if next character is a '*'

	* libmpio/mpio.c (mpio_strerror): fixed stupid bug no
	23.423.543.453.453 (time to go to bed)

2002-09-19  Andreas Buesching  <crunchy@tzi.de>

	* libmpio/mpio.c (mpio_strerror): fixed a strange bug with the
	argument name. Never call an argument errno?!?

2002-09-19  Markus Germeier  <mager@tzi.de>

	* mpiosh/callback.c (mpiosh_cmd_dump, mpiosh_cmd_mget) 
	(mpiosh_cmd_mdel, mpiosh_cmd_mput): fixed handling of an abort
	* libmpio/mpio.c (MPIO_ERR_RETURN): fixed buggy define


2002-09-19  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/mpiosh.c (mpiosh_command_regex_fix): hopefully fixed a
	bug (Sorry Markus)

	* mpiosh/callback.c (mpiosh_cmd_mput): using new error handling
	functions

	* libmpio/mpio.c (mpio_errno, mpio_strerror, mpio_perror): 
	  add functions for error handling
	  (mpio_file_get, mpio_file_put, mpio_file_del): using error
	  handling functions


2002-09-19  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_init_internal): 
	  added code to check if the internal memory is available
	  (don't ask! :-)
	  (mpio_sync): check if selected memory is available
	* mpiosh/callback.c (mpiosh_cmd_mem): 
	  fixed external mem check
	  

2002-09-18  Markus Germeier  <mager@tzi.de>

	* mpiosh/callback.c (mpiosh_cmd_mem): 
	  external memory is only selectable if it is available
	* libmpio/mpio.c (mpio_init): added progress callback
	  for init
	* mpiosh/callback.c (mpiosh_callback_init): 
	  added function
	* libmpio/io.c (cluster2block, cluster2blockaddress): 
	  removed wrong block mapping
	  (current mapping should work with complete error 
	   free SM cards _only_)
	  

2002-09-18  Andreas Buesching  <crunchy@tzi.de>

	* libmpio/mpio.c (mpio_file_get, mpio_file_put, mpio_file_del):
	using new error codes

	* libmpio/defs.h (MPIO_ERR_*): added definitions for possible
	errors codes

	* libmpio/mpio.c (mpio_model_name): moved model array from def.h;
	removed some compiler warnings (unused variables, missing return
	codes)

	* mpiosh/mpiosh.c (mpiosh_command_regex_fix): extented conditions
	to not replace sequences like ".*" by "\\..*"

2002-09-16  Andreas Buesching  <crunchy@tzi.de>

	* kernel/Makefile.am (install-strip): defined to avoid stripping
	of the kernel module

2002-09-16  Yuji Touya  <salmoon@users.sourceforge.net>

	* kernel/mpio.c: changed include file to resolve symbols
	* kernel/mpio.c (read_mpio): changed maxretry value
	* libmpio/io.c (model2externalmem): fixed function
	* libmpio/defs.h: added command, filetype and comments
	* README: modified "getting started"
	
2002-09-15  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/callback.c (mpiosh_cmd_ldir): checking more return values
	to avoid segmentation faults.

	* mpiosh/mpiosh.c: removed all references to the not implemented
	switch command (just for the next release)

	* configure.in (MODULE_PATH): checking for the right module
	directory and use it to install the mpio module

	* kernel/Makefile.am (install): the kernel module is now installed
	into the determinated module directory of the current kernel
	version.

	* mpio.spec.in: created rpm spec file for creating binary and
	source rpm packages

2002-09-15  Markus Germeier  <mager@tzi.de>

	* mpiosh/callback.c (mpiosh_cmd_debug_mem): added function 
	  call "debug_memory" in mpiosh
	* libmpio/io.c (model2externalmem): added function
	(mpio_io_set_cmdpacket): use model2externalmem
	* libmpio/mpio.c (mpio_init): added code to identify different
	  models	
	  (mpio_memory_debug): added function for debugging purposes

2002-09-15  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/mpiosh.c: add a debug message, displaying the executed
	command in script mode
	(mpiosh_command_regex_fix): better mapping for shell regular
	expressions (hopefully)

2002-09-15  Markus Germeier  <mager@tzi.de>

	* libmpio/directory.c: add debug informations,
	(mpio_dentry_get): fixed a off-by-one error

	* libmpio/mpio.h: add mpio_mem_t to dentry functions
	  to enable further debugging

2002-09-14  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/mpiosh.c: does not hang anymore after reading commands
	from a pipe

	* mpiosh/callback.c (mpiosh_callback_mget, mpiosh_callback_mput) 
	(mpiosh_callback_mdel): calling new function mpiosh_command_regex_fix

	* mpiosh/mpiosh.c: fixed output of none interactive mode
	(mpiosh_signal_handler, mpiosh_readline_cancel) 
	(mpiosh_noredisplay): functions added to get a expected handling
	of C-c (SIGINT)
	(mpiosh_command_regex_fix): add function. tries to map regular
	expressions to shell expressions. mapping '*' -> ".*" and '.' -> "\."

2002-09-13  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_file_put): fixed abort handling

2002-09-13  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/callback.c (mpiosh_callback_mget, mpiosh_callback_mput) 
	(mpiosh_callback_mdel): handling of user interrupt

	* mpiosh/mpiosh.c: handling for stdin being a tty

	* mpiosh/callback.c (mpiosh_callback_get, mpiosh_callback_put) 
	(mpiosh_callback_del): using mpiosh_cancel to abort operation

	* mpiosh/mpiosh.c: changed handling of SIGINT. The global variable
	mpiosh_cancel indicates the interrupt.

	* mpiosh/callback.c (mpiosh_cmd_help): add support for
	arguments. just prints help about specified commands.

	* mpiosh/mpiosh.c: add new command lpwd

2002-09-13  Markus Germeier  <mager@tzi.de>

	* mpiosh/callback.c (mpiosh_cmd_put, mpiosh_cmd_del) 
	(mpiosh_cmd_mdel, mpiosh_cmd_mput): use mpio_sync

	* libmpio/mpio.c (mpio_file_get, mpio_file_put) 
	(mpio_memory_format, mpio_file_del): add code to handle abort 
	"signal" from user interface
	(mpio_sync): added function

2002-09-12  Andreas Buesching  <crunchy@tzi.de>

	* mpiosh/mpiosh.c (mpiosh_command_split): 
	function added to support command sequences separated by ';'
	changed mpiosh_cmd_t structure, containing help string and
	argument information

	* mpiosh/callback.h, mpiosh/callback.c ():
	new files containing callback functions of shell commands
	(MPIOSH_CHECK_CONNECTION_OPEN, MPIOSH_CHECK_CONNECTION_CLOSED) 
	(MPIOSH_CHECK_ARG): macros for checking status of connection to
	player

2002-09-11  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_file_put,mpio_file_get): 
	  set timestamps on files correct
	* libmpio/directory.c (mpio_dentry_put): 
	  write correct 8.3 filenames into directory
	  (mpio_dentry_put): 
	  fixed handling of time stamps with a "little" help
	  from the current mtools distribution
	  (date_dos2unix): added function, copied from the linux
	  kernel
	  (mpio_dentry_get_time): added function, uses (date_dos2unix)

2002-09-11  Markus Germeier  <mager@tzi.de>

	* mpio_tool/mpiosh.c (mpiosh_cmd_mdel): added command mdel

2002-09-11  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_file_put): 
	  finished support for writing to internal memory
	  + changes to fat.c and io.c

2002-09-11  Markus Germeier  <mager@tzi.de>

	* libmpio/io.c (cluster2blockaddress): added function
	(mpio_io_block_write, mpio_io_sector_write): 
	  fixed block address in spare area
	(mpio_io_block_read): 
	  check block address and give debug output if address differs

2002-09-11  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_file_put): (+ various files)
	  updated writing support to support mpio_fatentry_t
	
2002-09-10  Markus Germeier  <mager@tzi.de>

	* libmpio/io.c (mpio_io_block_write): 
	  write FAT entry for internal mem
	* libmpio/fat.c (mpio_fat_internal_find_fileindex): added function

2002-09-10  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_memory_format): 
	  formatting works for internal and external memory now
	  BEWARE: No config files are written, you might ruin your
	  player!!!
	* libmpio/mpio.c   (mpio_file_del): 
	  deleting works for internal and external memory now (BEWARE !!!)
	* support for deleting/formatting added to various parts of
	  fat.c and io.c

2002-09-10  Markus Germeier  <mager@tzi.de>

	* libmpio/fat.c (mpio_fatentry_set_free) 
	(mpio_fatentry_set_defect): added functions
	* libmpio/io.c (mpio_io_block_delete): 
	  return negative status value in case of error
	* libmpio/mpio.c (mpio_memory_format): 
	  mark block/cluster defect in FAT if an error occurs during format
	* libmpio/mpio.c (mpio_file_del): 
	  changed function to support new mpio_fatentry_t

2002-09-09  Markus Germeier  <mager@tzi.de>

	* libmpio/io.c (fatentry2hw): added function
	(mpio_io_block_read, mpio_io_block_delete): 
	  use fatentry2hw

2002-09-09  Markus Germeier  <mager@tzi.de>

	* libmpio/mpio.c (mpio_memory_format): 
	  updated code to format external SmartMedia cards
	* libmpio/fat.c (mpio_fatentry_plus_plus, mpio_bootblocks_read): 
	  fixed max_cluster issues
	
2002-09-09  Markus Germeier  <mager@tzi.de>

	* libmpio/io.c (cluster2block): 
	  fixed cluster to block mapping for 32MB SmartMedia cards
	* libmpio/io.c (mpio_io_block_read, mpio_io_sector_read): 
	  added debug output in case of ECC error
	* libmpio/mpio.c (mpio_memory_free): 
	  fixed segmentation violation if no SM card is inserted
	* libmpio/mpio.c (mpio_get_info): 
	  *really* fixed the problem if no SM card is inserted
	
2002-09-09  Markus Germeier  <mager@tzi.de>

	* mpio_tool/mpiosh.c: 
	  (mpiosh_cmd_mput):
	  (mpiosh_cmd_mget):
		  make info texts consistent with get and put
	* libmpio/mpio.c (mpio_init_internal): 
	  fixed max_clusters for internal memory with more
	  then one chip
	* libmpio/fat.c (mpio_fatentry_hw2entry): added function
	* libmpio/fat.c (mpio_fatentry_entry2hw): added function
	* libmpio/fat.c: 
	  fixed support for MPIOs with more than one internal chip
	  (hopefully, someone please test this)

2002-09-08  Markus Germeier  <mager@tzi.de>

	* mpio_tool/mpiosh.c: 
	  (mpiosh_cmd_mput): fixed regex handling
	  (mpiosh_cmd_mget): fixed regex handling
	* regex for mput/mget does now work but uses "hard"
	  regular expressions instead of shell-like regex, e.g.:
	    "^0.*\.mp3$" ("hard" regular expression) 
	    "0*.mp3"     (shell-like)

2002-09-04  Andreas Buesching  <crunchy@tzi.de>

	* mpio_tool/mpiosh.c (mpiosh_cmd_mput): 
	added command mput. The arguments can be extended regular
	expressions. UNTESTED!
	(mpiosh_cmd_ldir): removed compiler warnings
	(mpiosh_cmd_mget): added command mget. The arguments can be
	extended regular expressions. UNTESTED!
	(mpiosh_cmd_help): updated help text

2002-09-03  Markus Germeier  <mager@tzi.de>

	* first part of "design" fixes
	* libmpio: 
	  - introduced mpio_fatentry_t
	  - reading support changed to mpio_fatentry_t
	  - writing and deleting deactivated
	    (this simply can't work right now)

2002-09-03  Yuji Touya  <salmoon@users.sourceforge.net>

	* add mkmpiodev script to create device file
	* README: add explanation to get started

2002-09-03  Markus Germeier  <mager@tzi.de>

	* libmpio/*: various "little" code cleanups

2002-09-01  Andreas Buesching  <crunchy@tzi.de>

	* mpio_tool/mpiosh.c: add commands lcd and ldir
	(mpiosh_cmd_dump): fixed a stupid bug
	(mpiosh_cmd_ldir): implemented the command ldir
	(mpiosh_cmd_lcd): implemented the command lcd

2002-08-22  Andreas Buesching  <crunchy@tzi.de>
	* README: fixed soome types and add a warning
	* AUTHORS: add salmoon to the list

2002-08-05  Andreas Buesching  <crunchy@tzi.de>

	* autogen.sh: add script to build configure script

